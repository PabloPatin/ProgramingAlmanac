<%*
const file = app.workspace.getActiveFile();
const cache = app.metadataCache.getFileCache(file);

if (!cache?.headings || cache.headings.length === 0) {
  tR += "> [!summary] ðŸ“‘ ÐžÐ³Ð»Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ\n> ÐÐµÑ‚ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¾Ð²\n";
  return;
}

// Ñ„Ð¸Ð»ÑŒÑ‚Ñ€ÑƒÐµÐ¼ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº "ÐžÐ³Ð»Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ", ÐµÑÐ»Ð¸ Ð¾Ð½ ÑƒÐ¶Ðµ ÐµÑÑ‚ÑŒ
const headings = cache.headings.filter(h => h.heading !== "ðŸ“‘ ÐžÐ³Ð»Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ");

let counters = [];
let output = [];

headings.forEach(h => {
  const level = h.level;

  counters[level - 1] = (counters[level - 1] || 0) + 1;
  counters = counters.slice(0, level);

  const number = counters.join(".");
  const indent = "  ".repeat(level - 1);

  const slug = h.heading
    .replace(/[^\w\s-]/g, "")
    .trim()
    .replace(/\s+/g, "-");

  const link = `${file.basename}#${slug}`;

  output.push(`${indent}${number} [[${link}|${h.heading}]]`);
});

tR += `> [!summary] ðŸ“‘ ÐžÐ³Ð»Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ\n>\n`;
output.forEach(line => {
  tR += `> ${line}\n`;
});
%>


