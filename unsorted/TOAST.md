---
tags:
  - postgres
  - база_данных
  - sql
---
Типы данных TEXT, JSON, JSONB, BYTEA хранятся в TOAST таблицах если размер кортежа превышает 1/4 страницы
Атрибут должен весить больше 2 КБ, чтобы он был записан в TOAST
Когда текст выносится в TOAST, он заменяется на ссылку

Схема pg_toast хранит все TOAST таблицы

TOAST хранит все версии строк, по мере их изменения

Для того, чтобы обновления накапливались в TOAST таблицы, лучше отключить AUTOVACUUM
# Стратегии TOAST
ALTER COLUMN *column_name* SET STORAGE MAIN/EXTERNAL/EXTENDED
## EXTERNAL
Допускает хранение вне таблицы, но не сжатие
## MAIN
Сжатие, но не отдельное хранение
## EXTENDING
Хранение + сжатие
# Недостатки TOAST
- Нельзя отказаться от использования TOAST при работе с указанными таипами данных 
- Механизм TOAST не имеет операции UPDATE как таковой. Старые записи не удаляются, а помечаются как dead
- Максимально возможное количество строк в TOAST $2^{32}$
- 1 TOAST таблица на 1 таблицу БД
- TOAST часть ядра Postgres, его невозможно модифицировать