---
tags:
  - postgres
---

wal_level=minimal - хранит данные только для аварийного восстановления
# Физическая
В реплике должен быть файл `standby.signal`
Использует журнал WAL
Данные реплики можно автоматически создать с помощью
pg_basebackup --host ip_хоста/domain_name -U пользователь --pgdata=путь_папки_для_сохранения_копии -R
## Настройка основной базы
wal_level=replica
max_wal_senders - должен быть больше 0 как у матера, так и у реплики
## Настройка реплики
wal_level=hot_standby
# Логическая
Может реплицировать отдельные объекты
Медленнее физической по скорости копирования
Может выигрывать за счёт того, что копирует только часть данных
## Настройка основной базы
wal_level=logical
max_replication_slots - должен быть больше количества подпищиков
На основной база настраивается публикация
В публикации можно указать, какие DML операции нужно транслировать в реплику
Создание публикации
`CREATE PUBLICATION имя_публикации FOR таблица, [таблица...] / ALL TABLES`
Изменение публикации
`ALTER PUBLICATION`
## Настройка реплики
На реплике необходимо настроить подписку
Реплика может сама стать публикатором и транслировать свои изменения
Создание подписки:
CREATE SUBSCRIPTION имя_подписки CONNECTION строка подключения
# Просмотр информации о репликации
pg_stat_replication (содержит номера строк журнала wal, на которых сейчас находится репликация)
pg_replication_slots
pg_stat_replication_slots
pg_stat_subscription
...
# Проблемы репликации
- Отказ узлов, невозможность передачи журнала
- Задержка при передачи журнала
...
